version: 2.1
jobs: # A basic unit of work in a run
  build: # runs not using Workflows must have a `build` job as entry point 
    # directory where steps are run
    working_directory: ~/work_dir
    docker: # run the steps with Docker
      - image: circleci/python:3.6.9
    steps: # steps that comprise the `build` job
      - checkout
      - run:
          command: |
            sudo pip install requests
            sudo pip install pyyaml
            sudo pip install PyGithub
            sudo pip install numpy
            sudo pip install matplotlib
      - run:
          no_output_timeout: 10m #change this to set the limit for how long it can run...useful for when Beluga crashes.
          command: |
            python NeuroCI.py --cbrain-user="${cbrain_user}" --cbrain-password="${cbrain_password}" --CCI-token="${CCI_token}" --artifacts-url="https://circleci.com/api/v1.1/project/github/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME/latest/artifacts"
            mkdir artifacts
            cp *.json artifacts
            python analysesVisualizations.py $cbrain_user $cbrain_password
      - store_test_results:
          path: ~/test-results
      - store_artifacts:
          path: /home/circleci/work_dir/artifacts
          destination: artifact-file

workflows:
  version: 2.1
  build-workflow:
    jobs:
      - build
  schedule-workflow:
    triggers:
      - schedule:
          cron: "0 0 1 1 *" #0 0 * * 0 for weekly, 0 * * * * for hourly, 0 0,6,12,18 * * * for every 6hrs, 0 0 * * * for daily.
          filters:
            branches:
              only:
                - master
    jobs:
      - build
